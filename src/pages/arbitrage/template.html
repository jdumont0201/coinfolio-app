<div [@.disabled]="true">
    <mat-toolbar>
        <h3>Arbitrage</h3>
    </mat-toolbar>
    <app-top-right-buttons [showSearch]="false"></app-top-right-buttons>
    <div class="arbitrage-grid tablef clickable">
        <div class="trf">
            <div class="tdf"></div>
            <div class="tdf"></div>
            <div class="tdf bgvalpos" style="text-align:right">Buy</div>
            <div class="tdf bgvalpos"></div>
            <div class="tdf bgvalneg" style="text-align:right">Sell</div>
            <div class="tdf bgvalneg"></div>
        </div>
        <div class="trf">
            <div class="tdf">Pair</div>
            <div class="tdf">Spread</div>
            <div class="tdf bgvalpos"> Broker</div>
            <div class="tdf bgvalpos"> Price</div>
            <div class="tdf bgvalneg"> Broker</div>
            <div class="tdf bgvalneg"> Price</div>
        </div>
        <ng-container *ngFor="let li of sortedGrid">
            <ng-container *ngIf=" getKeys(li.list.brokers).length>1">
                <div>
                    <div (click)="toggleDisplay(li.pair)" class="trf">
                        <div class="tdf">
                            <span class="supra">{{li.supra}}</span> / <span class="infra">{{li.infra}}</span>
                        </div>
                        <div class="tdf ">
                            {{li.spread |number:'1.1-1'}}%
                        </div>
                        <div class="tdf">
                            <span class="broker-icon notext broker-{{li.list.cheapestaskname}}"></span><span class="hide-mobile">{{li.list.cheapestaskname}}</span>
                        </div>
                        <div class="tdf">{{li.list.cheapestask}}<br>
                        </div>
                        <div class="tdf">
                            <span class="broker-icon notext broker-{{li.list.mostexpensivebidname}}"></span><span class="hide-mobile">{{li.list.mostexpensivebidname }}</span>
                        </div>
                        <div class="tdf">
                            {{li.list.mostexpensivebid}}
                        </div>
                    </div>
                    <div *ngIf="displayed[li.pair]" class="tdf2">
                        <div class="arbitrage-header padded">
                            <div class="td big">
                                {{li.pair}}
                            </div>
                            <br>
                            <div class="td ">
                                <span class="valpos">

                                Real spread {{(li.list.postbid/li.list.preask * li.list.mostexpensivebid/li.list.cheapestask - (li.list.infra=='USD'?6:4)*0.001 -1 )*100  |number:'1.1-1' }}%
</span>
                                <br>Raw spread:{{li.spread |number:'1.1-1'}}%<br><br>


                                <br>
                                Budget:{{budget}}USD<br>

                                <div class="table">
                                    <div class="tr">
                                        <div class="td">Order</div>
                                        <div class="td">Pair</div>
                                        <div class="td">Price</div>
                                        <div class="td">Broker</div>
                                        <div class="td">Qty</div>
                                        <div class="td">Commission</div>
                                    </div>

                                    <div class="tr">
                                        <div class="td">Buy</div>
                                        <div class="td">{{li.list.infra}}USD</div>
                                        <div class="td"> {{li.list.preask}}</div>
                                        <div class="td"><span class="broker-icon notext broker-{{li.list.cheapestaskname}}"></span>{{li.list.cheapestaskname}}</div>
                                        <div class="td">{{budget / li.list.preask}}</div>
                                        <div class="td">{{budget * getTradingCommission(li.list.cheapestaskname,li.pair)}}</div>
                                    </div>
                                    <div class="tr">
                                        <div class="td">Buy</div>
                                        <div class="td">{{li.pair}}</div>
                                        <div class="td"> {{li.list.cheapestask}}</div>
                                        <div class="td"><span class="broker-icon notext broker-{{li.list.cheapestaskname}}"></span>{{li.list.cheapestaskname}}</div>
                                        <div class="td">{{budget / li.list.preask / li.list.cheapestask}}</div>
                                        <div class="td">{{budget * getTradingCommission(li.list.cheapestaskname,li.pair)}}</div>
                                    </div>
                                    <div class="tr">
                                        <div class="td">Withdraw</div>
                                        <div class="td">{{li.pair}}</div>
                                        <div class="td"></div>
                                        <div class="td"><span class="broker-icon notext broker-{{li.list.cheapestaskname}}"></span>{{li.list.cheapestaskname}}</div>
                                        <div class="td">{{budget / li.list.preask / li.list.cheapestask}}</div>
                                        <div class="td">{{budget * getDepositCommission(li.list.cheapestaskname,li.pair)}}</div>
                                    </div>
                                    <div class="tr">
                                        <div class="td">Deposit</div>
                                        <div class="td">{{li.pair}}</div>
                                        <div class="td"></div>
                                        <div class="td"><span class="broker-icon notext broker-{{li.list.mostexpensivebidname}}"></span>@{{li.list.mostexpensivebidname}}</div>
                                        <div class="td">{{budget / li.list.preask / li.list.cheapestask}}</div>
                                        <div class="td">{{budget * getDepositCommission(li.list.cheapestaskname,li.pair)}}</div>
                                    </div>
                                    <div class="tr">
                                        <div class="td">Sell</div>
                                        <div class="td">{{li.pair}}</div>
                                        <div class="td"> {{li.list.mostexpensivebid}}</div>
                                        <div class="td"><span class="broker-icon notext broker-{{li.list.mostexpensivebidname}}"></span>@{{li.list.mostexpensivebidname}}</div>
                                        <div class="td">{{budget / li.list.preask / li.list.cheapestask}}</div>
                                        <div class="td">{{budget * getTradingCommission(li.list.cheapestaskname,li.pair)}}</div>
                                    </div>
                                    <div class="tr">
                                        <div class="td">Sell</div>
                                        <div class="td">{{li.list.infra}}USD</div>
                                        <div class="td"> {{li.list.postbid}}</div>
                                        <div class="td"><span class="broker-icon notext broker-{{li.list.mostexpensivebidname}}"></span>@{{li.list.mostexpensivebidname}}</div>
                                        <div class="td">{{budget / li.list.preask / li.list.cheapestask}}</div>
                                        <div class="td">{{budget * getTradingCommission(li.list.cheapestaskname,li.pair)}}</div>
                                    </div>
                                </div>
                            </div>

                            <button mat-raised-button (click)="open(li.pair,li.list.cheapestaskname)">{{li.list.cheapestaskname}}</button>
                            <button mat-raised-button (click)="open(li.pair,li.list.mostexpensivebidname)">{{li.list.mostexpensivebidname}}</button>
                        </div>
                        <div class="table">
                            <div class="tr">
                                <div class="td">Broker</div>
                                <div class="td"></div>
                                <div class="td">Bid</div>
                                <div class="td">Ask</div>
                            </div>
                            <ng-container *ngFor="let broker of getKeys(li.list.brokers)">
                                <div class="tr">
                                    <div class="td" (click)="open(li.pair,li.list.brokers[broker].broker)"><span class="broker-{{li.list.brokers[broker].broker}}"><span
                                            class="broker-icon notext broker-{{li.list.brokers[broker].broker}}"></span><a
                                            class="link">{{li.list.brokers[broker].broker}}</a></span>
                                    </div>
                                    <div class="td"></div>
                                    <div class="td"><span
                                            class="{{li.list.brokers[broker].oldbid>0?(li.list.brokers[broker].oldbid>li.list.brokers[broker].bid?'valneg':'valpos'):''}}"> {{li.list.brokers[broker].bid | price}} <mat-icon>{{li.list.brokers[broker].oldbid>0?(li.list.brokers[broker].oldbid>li.list.brokers[broker].bid?"arrow_downward":"arrow_upward"):''}}</mat-icon></span>
                                    </div>
                                    <div class="td"><span
                                            class="{{li.list.brokers[broker].oldask>0?(li.list.brokers[broker].oldask>li.list.brokers[broker].ask?'valneg':'valpos'):''}}"> {{li.list.brokers[broker].ask |price}} <mat-icon>{{li.list.brokers[broker].oldask>0?(li.list.brokers[broker].oldask>li.list.brokers[broker].ask?"arrow_downward":"arrow_upward"):''}}</mat-icon> </span>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-container>
    </div>
</div>