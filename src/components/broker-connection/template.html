<app-wrong-param [isErrored]="isErrored" [errorMessage]="errorMessage"></app-wrong-param>

<div *ngIf="user" class="broker-newconfig">

    <ng-container *ngIf="!user[enabledKey]">

        <mat-horizontal-stepper #stepper>
            <mat-step label="Open an account">
                <h5>Do you have an account at {{brokerName}} ?</h5>
                <div class="col-2">
                    <div class="col-2-1 centered">
                        <button mat-raised-button="" (click)="goTo(appConfigService.brokersLinks[broker].signup)">Sign up at {{broker}}</button>
                    </div>
                    <div class="col-2-2 centered">
                        <button mat-raised-button (click)="stepper.next()">I have my account</button>
                        <br><br>

                    </div>

                </div>
                <div class="centered"><button mat-raised-button (click)="restore()">Restore my previous keys</button></div>
            </mat-step>
            <mat-step label="Create API Keys">
                <h5>Create your API Keys at {{brokerName}}</h5>
                <div class="col-2">
                    <div class="col-2-1 centered">
                <button mat-raised-button="" (click)="goTo(appConfigService.brokersLinks[broker].api)">Create an API token</button>
                    </div>
                    <div class="col-2-2 centered"><button mat-raised-button (click)="stepper.next()">I've got my keys</button>
                    </div>
                </div>
            </mat-step>
            <mat-step label="Connect">
                <h5>Fill your API Keys below and submit</h5>
                <div class="form">
                    <form>
                        <div>
                            <mat-form-field><input name="BinanceAPIKey" matInput [(ngModel)]="user[enabledKey+'APIKey']"
                                                   placeholder="API Key">
                            </mat-form-field>
                        </div>
                        <div>
                            <mat-form-field><input name="BinanceAPISecret" matInput [(ngModel)]="user[enabledKey+'APISecret']"
                                                   placeholder="API Secret"></mat-form-field>
                        </div>
                        <button mat-raised-button="" class="large hasicon" (click)="submit('firsttime')" color="primary">
                            <mat-icon>send</mat-icon>
                            Save
                        </button>
                    </form>
                </div>
            </mat-step>

        </mat-horizontal-stepper>


    </ng-container>
    <ng-container *ngIf="user[enabledKey]"  class="broker-existingconfig">

        <mat-tab-group #tabGroup [(selectedIndex)]="selectedIndex" >
            <mat-tab label="Review">
                <div class="padded">
                {{brokerName}} is configured properly.
                </div>
                <div class="col-2">
                    <div class="col-2-1 centered">

                        <button mat-raised-button (click)="disable()">Disable</button>
                    </div>
                    <div class="col-2-2 centered">
                        <button mat-raised-button (click)="selectedIndex=2">Modify my API key</button>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Rights">
                <div class="broker-connection-table padded" >
                    <div class="broker-connection-table-tr">
                        <div>Public data</div>
                        <div>
                            <mat-icon>{{checks[broker]?.publicdata?'check':'not_interested'}}</mat-icon>
                        </div>
                    </div>
                    <div class="broker-connection-table-tr">
                        <div>Read-only user data</div>
                        <div>
                            <mat-icon>{{checks[broker]?.privatedata?'check':'not_interested'}}</mat-icon>
                        </div>
                    </div>
                    <div class="broker-connection-table-tr">
                        <div>Send orders</div>
                        <div>
                            <mat-icon>{{checks[broker]?.orders?'check':'not_interested'}}</mat-icon>
                        </div>
                    </div>
                    <div class="broker-connection-table-tr">
                        <div>Withdrawals</div>
                        <div>
                            <mat-icon>{{checks[broker]?.withdraw?'check':'not_interested'}}</mat-icon>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Edit keys">
                <div class="form">
                <form>
                    <div>
                        <mat-form-field><input name="BinanceAPIKey" matInput [(ngModel)]="user['Connection'+broker.charAt(0).toUpperCase() + broker.slice(1)+'APIKey']"
                                               placeholder="API Key">
                        </mat-form-field>
                    </div>
                    <div>
                        <mat-form-field><input name="BinanceAPISecret" matInput [(ngModel)]="user['Connection'+broker.charAt(0).toUpperCase() + broker.slice(1)+'APISecret']"
                                               placeholder="API Secret"></mat-form-field>
                    </div>
                    <button mat-raised-button="" class="large hasicon" (click)="submit('existing')" color="primary">
                        <mat-icon>send</mat-icon>
                        Save
                    </button>
                </form>
                </div>
            </mat-tab>
        </mat-tab-group>


    </ng-container>
</div>

